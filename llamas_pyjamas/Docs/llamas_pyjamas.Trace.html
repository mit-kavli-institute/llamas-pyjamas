

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>llamas_pyjamas.Trace package &mdash; llamas-pyjamas 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=8d563738"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            llamas-pyjamas
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">llamas-pyjamas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">llamas_pyjamas.Trace package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/llamas_pyjamas.Trace.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="llamas-pyjamas-trace-package">
<h1>llamas_pyjamas.Trace package<a class="headerlink" href="#llamas-pyjamas-trace-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-llamas_pyjamas.Trace.traceLlamas">
<span id="llamas-pyjamas-trace-tracellamas-module"></span><h2>llamas_pyjamas.Trace.traceLlamas module<a class="headerlink" href="#module-llamas_pyjamas.Trace.traceLlamas" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamas.</span></span><span class="sig-name descname"><span class="pre">TraceLlamas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naxis1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naxis2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bench</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#TraceLlamas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class for tracing fiber positions in LLAMAS observations.</p>
<p>This class handles the tracing of fiber positions and profile fitting for
LLAMAS spectrograph data.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.data">
<span class="sig-name descname"><span class="pre">data</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.data" title="Link to this definition"></a></dt>
<dd><p>The image data array.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.naxis1">
<span class="sig-name descname"><span class="pre">naxis1</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.naxis1" title="Link to this definition"></a></dt>
<dd><p>The x-axis dimension of the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.naxis2">
<span class="sig-name descname"><span class="pre">naxis2</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.naxis2" title="Link to this definition"></a></dt>
<dd><p>The y-axis dimension of the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.bench">
<span class="sig-name descname"><span class="pre">bench</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.bench" title="Link to this definition"></a></dt>
<dd><p>The bench identifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.side">
<span class="sig-name descname"><span class="pre">side</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.side" title="Link to this definition"></a></dt>
<dd><p>The side identifier.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.channel">
<span class="sig-name descname"><span class="pre">channel</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.channel" title="Link to this definition"></a></dt>
<dd><p>The channel identifier (red, green, blue).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.nfibers">
<span class="sig-name descname"><span class="pre">nfibers</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.nfibers" title="Link to this definition"></a></dt>
<dd><p>Number of fibers detected.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.xmin">
<span class="sig-name descname"><span class="pre">xmin</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.xmin" title="Link to this definition"></a></dt>
<dd><p>Minimum x position for trace fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.xmax">
<span class="sig-name descname"><span class="pre">xmax</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.xmax" title="Link to this definition"></a></dt>
<dd><p>Maximum x position for trace fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.fitspace">
<span class="sig-name descname"><span class="pre">fitspace</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.fitspace" title="Link to this definition"></a></dt>
<dd><p>Spacing between trace fitting points.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.traces">
<span class="sig-name descname"><span class="pre">traces</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.traces" title="Link to this definition"></a></dt>
<dd><p>Array containing the traced fiber positions.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.bspline_ssets">
<span class="sig-name descname"><span class="pre">bspline_ssets</span></span><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.bspline_ssets" title="Link to this definition"></a></dt>
<dd><p>List of B-spline sets for profile fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naxis1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">naxis2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bench</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">side</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#TraceLlamas.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize the TraceLlamas object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>np.ndarray</em><em>, </em><em>optional</em>) – The image data array. Defaults to 0.</p></li>
<li><p><strong>naxis1</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><em>optional</em>) – The x-axis dimension of the data. Defaults to 0.</p></li>
<li><p><strong>naxis2</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>, </em><em>optional</em>) – The y-axis dimension of the data. Defaults to 0.</p></li>
<li><p><strong>bench</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – The bench identifier. Defaults to ‘’.</p></li>
<li><p><strong>side</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – The side identifier. Defaults to ‘’.</p></li>
<li><p><strong>channel</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – The channel identifier. Defaults to ‘’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.traceSingleCamera">
<span class="sig-name descname"><span class="pre">traceSingleCamera</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#TraceLlamas.traceSingleCamera"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.traceSingleCamera" title="Link to this definition"></a></dt>
<dd><p>Trace fiber positions for a single camera.</p>
<p>This method traces the fiber positions across the detector for a single camera
by detecting peaks in vertical slices and fitting trace functions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataobj</strong> – Data object containing header and image data.</p></li>
<li><p><strong>mph</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><em>float</em></a><em>, </em><em>optional</em>) – Minimum peak height for peak detection. If None,
an automatic threshold will be calculated. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Returns 0 if the channel is red (saturated flats), otherwise traces</dt><dd><p>are stored in the object attributes.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.profileFit">
<span class="sig-name descname"><span class="pre">profileFit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#TraceLlamas.profileFit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.profileFit" title="Link to this definition"></a></dt>
<dd><p>Fit spatial profiles for each fiber.</p>
<p>This method fits B-spline profiles to each fiber, normalizing out spectral
variations and generating profile weight images for optimal extraction.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>fiberimg (np.ndarray): Image where each pixel contains the fiber number.</p></li>
<li><p>profimg (np.ndarray): Profile weight image for optimal extraction.</p></li>
<li><p>bpmask (np.ndarray): Bad pixel mask.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.TraceLlamas.fiberProfileImg">
<span class="sig-name descname"><span class="pre">fiberProfileImg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fiber_index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#TraceLlamas.fiberProfileImg"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.TraceLlamas.fiberProfileImg" title="Link to this definition"></a></dt>
<dd><p>Generate a profile image for a single fiber.</p>
<p>This method creates a profile weight image for a specific fiber using
the previously fitted B-spline profile.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fiber_index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) – The index of the fiber to generate the profile for.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>2D profile image with weights for the specified fiber.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.saveTraces">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamas.</span></span><span class="sig-name descname"><span class="pre">saveTraces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">objlist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LLAMASTrace.h5'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#saveTraces"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.saveTraces" title="Link to this definition"></a></dt>
<dd><p>Save a list of TraceLlamas objects to file.</p>
<p>This function saves TraceLlamas objects to either pickle (.pkl) or HDF5 (.h5) format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>objlist</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a>) – List of TraceLlamas objects to save.</p></li>
<li><p><strong>outfile</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>, </em><em>optional</em>) – Output filename. Defaults to ‘LLAMASTrace.h5’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.loadTraces">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamas.</span></span><span class="sig-name descname"><span class="pre">loadTraces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">infile</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#loadTraces"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.loadTraces" title="Link to this definition"></a></dt>
<dd><p>Load TraceLlamas objects from file.</p>
<p>This function loads TraceLlamas objects from either pickle (.pkl) or HDF5 (.h5) format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>infile</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Input filename to load from.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>List of TraceLlamas objects (for .h5 files) or the loaded</dt><dd><p>object (for .pkl files).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)">list</a> or <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)">object</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamas.traceAllCameras">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamas.</span></span><span class="sig-name descname"><span class="pre">traceAllCameras</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataobj_all</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamas.html#traceAllCameras"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamas.traceAllCameras" title="Link to this definition"></a></dt>
<dd><p>Trace fibers for all cameras in a dataset.</p>
<p>This function traces fibers for all camera extensions in the provided data object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dataobj_all</strong> – Data object containing multiple camera extensions.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of TraceLlamas objects, one for each camera extension.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)">list</a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-llamas_pyjamas.Trace.traceLlamasMaster">
<span id="llamas-pyjamas-trace-tracellamasmaster-module"></span><h2>llamas_pyjamas.Trace.traceLlamasMaster module<a class="headerlink" href="#module-llamas_pyjamas.Trace.traceLlamasMaster" title="Link to this heading"></a></h2>
<p>Module: traceLlamasMaster
This module provides functionality for processing and tracing fiber positions in LLAMAS FITS files using Ray multiprocessing to produce a set of Master traces.
It includes classes and functions to handle FITS file data, detect peaks, fit B-splines, and generate trace profiles for fibers.
Classes:</p>
<blockquote>
<div><dl class="simple">
<dt>TraceLlamas:</dt><dd><p>A class for processing and tracing fiber positions in LLAMAS FITS files.
It includes methods for detecting peaks, fitting B-splines, generating trace profiles, and saving trace data.</p>
</dd>
<dt>TraceRay(TraceLlamas):</dt><dd><p>A subclass of TraceLlamas that uses Ray for parallel processing of HDU data in FITS files.</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Functions:</dt><dd><dl class="simple">
<dt>run_ray_tracing(fitsfile: str, channel: str = None) -&gt; None:</dt><dd><p>Runs the tracing process on the specified FITS file using Ray multiprocessing.</p>
</dd>
</dl>
</dd>
<dt>Usage:</dt><dd><p>This module can be run as a standalone script to process LLAMAS FITS files.
Use the command line arguments to specify the input FITS file and optional parameters.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>python traceLlamasMaster.py filename.fits –channel blue</p>
<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.check_fibre_number">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster.</span></span><span class="sig-name descname"><span class="pre">check_fibre_number</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fibre_number</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#check_fibre_number"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.check_fibre_number" title="Link to this definition"></a></dt>
<dd><p>Check if the given fibre number is within the valid range.
:param fibre_number: The fibre number to check.
:type fibre_number: int</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if the fibre number is valid, False otherwise.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.get_fiber_position">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster.</span></span><span class="sig-name descname"><span class="pre">get_fiber_position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">fiber</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#get_fiber_position"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.get_fiber_position" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster.</span></span><span class="sig-name descname"><span class="pre">TraceLlamas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.__init__" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.__getstate__">
<span class="sig-name descname"><span class="pre">__getstate__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.__getstate__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.__getstate__" title="Link to this definition"></a></dt>
<dd><p>Return the state of the object for serialization.
This method is called by the pickle module to retrieve the current state of the object.
Override this method to control what data is saved when the object is pickled.
:returns: A dictionary representing the object’s state. By default, no state is captured.
:rtype: dict</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.__setstate__">
<span class="sig-name descname"><span class="pre">__setstate__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.__setstate__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.__setstate__" title="Link to this definition"></a></dt>
<dd><p>Set the state of the object after deserialization.
This method is called by the pickle module to restore the object’s state.
Override this method to control how the object’s state is set when unpickled.
:param state: A dictionary representing the object’s state.
:type state: dict</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.insert_dead_fibers">
<span class="sig-name descname"><span class="pre">insert_dead_fibers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LUT</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">pkhts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.insert_dead_fibers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.insert_dead_fibers" title="Link to this definition"></a></dt>
<dd><p>Inserts zero values into the pkhts list at positions specified by dead fibers.
This method retrieves the list of dead fibers for a given benchside from the LUT (Lookup Table),
sorts the list, and then inserts a zero value into the pkhts list at each position corresponding
to a dead fiber.
:param LUT: A lookup table containing information about dead fibers.
:type LUT: dict
:param benchside: The benchside identifier to retrieve dead fibers for.
:type benchside: str
:param pkhts: A list of pkhts values where zeros will be inserted at positions of dead fibers.
:type pkhts: list</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The updated pkhts list with zeros inserted at positions of dead fibers.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.generate_valleys">
<span class="sig-name descname"><span class="pre">generate_valleys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tslice</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.generate_valleys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.generate_valleys" title="Link to this definition"></a></dt>
<dd><p>Detects valleys in the given data slice and returns their indices, depths, and an array of ones.
Parameters:
———–
tslice : float</p>
<blockquote>
<div><p>The data slice in which to detect valleys.</p>
</div></blockquote>
<section id="returns">
<h3>Returns:<a class="headerlink" href="#returns" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>Tuple[np.ndarray, …]</dt><dd><p>A tuple containing:
- valley_indices (np.ndarray): The indices of the detected valleys.
- valley_depths (np.ndarray): The depths of the detected valleys.
- invvar (np.ndarray): An array of ones with the same length as the number of detected valleys.</p>
</dd>
</dl>
</section>
<section id="notes">
<h3>Notes:<a class="headerlink" href="#notes" title="Link to this heading"></a></h3>
<p>If no valleys are detected, a log message is generated indicating that no valleys were found and suggesting to check the threshold.</p>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.fit_bspline">
<span class="sig-name descname"><span class="pre">fit_bspline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">valley_indices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">valley_depths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">invvar</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.fit_bspline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.fit_bspline" title="Link to this definition"></a></dt>
<dd><p>Fit a B-spline to the given valley indices and depths.
Parameters:
valley_indices (np.ndarray): Array of indices where valleys are located.
valley_depths (np.ndarray): Array of depths corresponding to the valley indices.
invvar (np.ndarray): Inverse variance of the valley depths.
Returns:
Tuple[np.ndarray, …]: A tuple containing the x_model and the fitted y_model values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.fit_grid_single">
<span class="sig-name descname"><span class="pre">fit_grid_single</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xtmp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bspline</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.fit_grid_single"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.fit_grid_single" title="Link to this definition"></a></dt>
<dd><p>Fits a B-spline to a slice of the data at a given x-window point.
Parameters:
———–
xtmp : int</p>
<blockquote>
<div><p>The x-coordinate around which the y-slice is taken.</p>
</div></blockquote>
<section id="id1">
<h3>Returns:<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>comb<span class="classifier">np.ndarray</span></dt><dd><p>The combined result of the y-slice minus the B-spline model.</p>
</dd>
<dt>sset<span class="classifier">bspline</span></dt><dd><p>The B-spline object fitted to the data.</p>
</dd>
<dt>res<span class="classifier">int</span></dt><dd><p>The result of the B-spline fitting process.</p>
</dd>
<dt>yfit<span class="classifier">np.ndarray</span></dt><dd><p>The fitted y-values from the B-spline model.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.find_comb">
<span class="sig-name descname"><span class="pre">find_comb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rownum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.find_comb"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.find_comb" title="Link to this definition"></a></dt>
<dd><p>Find and process the comb of peaks in the data.
This function extracts a slice of the data around the specified row number,
identifies valleys, fits a B-spline to the valleys, and then finds peaks
in the residuals after subtracting the fitted B-spline.
Parameters:
rownum (int, optional): The row number around which to extract the data slice.</p>
<blockquote>
<div><p>If None, the middle row is used.</p>
</div></blockquote>
<p>Returns:
numpy.ndarray: The comb of peaks in the data slice after subtracting the fitted B-spline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.process_hdu_data">
<span class="sig-name descname"><span class="pre">process_hdu_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdu_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdu_header</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.process_hdu_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.process_hdu_data" title="Link to this definition"></a></dt>
<dd><p>Processes data from a specific HDU (Header Data Unit) array.
Parameters:
———–
hdu_data : np.ndarray</p>
<blockquote>
<div><p>The data array from the HDU to be processed.</p>
</div></blockquote>
<dl class="simple">
<dt>hdu_header<span class="classifier">dict</span></dt><dd><p>The header information associated with the HDU data.</p>
</dd>
<dt>find_LUT<span class="classifier">bool, optional</span></dt><dd><p>Flag to determine whether to find and use a Look-Up Table (LUT) for processing (default is False).</p>
</dd>
</dl>
<section id="id2">
<h3>Returns:<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>dict</dt><dd><p>A dictionary containing the status of the processing. If successful, returns {“status”: “success”}.
If an error occurs, returns {“status”: “failed”, “error”: str(e), ‘channel’: self.channel, ‘bench’: self.bench, ‘side’: self.side}.</p>
</dd>
</dl>
</section>
<section id="description">
<h3>Description:<a class="headerlink" href="#description" title="Link to this heading"></a></h3>
<p>This method processes the HDU data by performing the following steps:
1. Initializes the bspline_ssets list.
2. Extracts and processes header information to determine the channel, bench, and side.
3. Extracts the dimensions of the data (NAXIS1 and NAXIS2).
4. Finds the initial comb for the data to be fitted.
5. Updates peaks and peak heights, ensuring they are not too close to the edge.
6. Optionally, opens and uses a trace Look-Up Table (LUT) to account for dead fibers.
7. Determines the number of fibers and the maximum x-axis value for tracing.
8. Fits combs from the midpoint forward and then backward, updating peak positions.
9. Defines the coordinates of the trace along the x-axis and fits a spline along the x-axis for each fiber.
10. Interpolates the traces to give x, y positions for each fiber along the naxis.
Exceptions:
———–
If an error occurs during processing, the method catches the exception, logs the error, and returns a dictionary with the status “failed” and the error message.</p>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.profileFit">
<span class="sig-name descname"><span class="pre">profileFit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.profileFit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.profileFit" title="Link to this definition"></a></dt>
<dd><p>Fits the spatial profile of fibers in the data.
This method normalizes the data, generates masks for bad pixels, and fits
the spatial profile of fibers using a bspline. The results are stored in
the instance variables <cite>fiberimg</cite>, <cite>profimg</cite>, and <cite>bpmask</cite>.
:returns:</p>
<blockquote>
<div><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>fiberimg (ndarray): An array listing the fiber number of each pixel.</p></li>
<li><p>profimg (ndarray): An array containing the profile weighting function.</p></li>
<li><p>bpmask (ndarray): A boolean array representing the bad pixel mask.</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.saveTraces">
<span class="sig-name descname"><span class="pre">saveTraces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LLAMASTrace.pkl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newpath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#TraceLlamas.saveTraces"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.TraceLlamas.saveTraces" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster.run_ray_tracing">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster.</span></span><span class="sig-name descname"><span class="pre">run_ray_tracing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outpath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'/Users/slhughes/Work/Pipelines/llamas-pyjamas/llamas_pyjamas/mastercalib'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster.html#run_ray_tracing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster.run_ray_tracing" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-llamas_pyjamas.Trace.traceLlamasMaster_backup">
<span id="llamas-pyjamas-trace-tracellamasmaster-backup-module"></span><h2>llamas_pyjamas.Trace.traceLlamasMaster_backup module<a class="headerlink" href="#module-llamas_pyjamas.Trace.traceLlamasMaster_backup" title="Link to this heading"></a></h2>
<p>Module: traceLlamasMaster
This module provides functionality for processing and tracing fiber positions in LLAMAS FITS files using Ray multiprocessing to produce a set of Master traces.
It includes classes and functions to handle FITS file data, detect peaks, fit B-splines, and generate trace profiles for fibers.
Classes:</p>
<blockquote>
<div><dl class="simple">
<dt>TraceLlamas:</dt><dd><p>A class for processing and tracing fiber positions in LLAMAS FITS files.
It includes methods for detecting peaks, fitting B-splines, generating trace profiles, and saving trace data.</p>
</dd>
<dt>TraceRay(TraceLlamas):</dt><dd><p>A subclass of TraceLlamas that uses Ray for parallel processing of HDU data in FITS files.</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>Functions:</dt><dd><dl class="simple">
<dt>run_ray_tracing(fitsfile: str, channel: str = None) -&gt; None:</dt><dd><p>Runs the tracing process on the specified FITS file using Ray multiprocessing.</p>
</dd>
</dl>
</dd>
<dt>Usage:</dt><dd><p>This module can be run as a standalone script to process LLAMAS FITS files.
Use the command line arguments to specify the input FITS file and optional parameters.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>python traceLlamasMaster.py filename.fits –channel blue</p>
<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.get_fiber_position">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster_backup.</span></span><span class="sig-name descname"><span class="pre">get_fiber_position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">fiber</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#get_fiber_position"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.get_fiber_position" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster_backup.</span></span><span class="sig-name descname"><span class="pre">TraceLlamas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A class used to trace and process fiber data from FITS files.
Attributes
———-
fitsfile : str</p>
<blockquote>
<div><p>The path to the FITS file.</p>
</div></blockquote>
<dl class="simple">
<dt>mph<span class="classifier">Optional[int]</span></dt><dd><p>Minimum peak height for peak detection.</p>
</dd>
<dt>master_trace<span class="classifier">Optional[str]</span></dt><dd><p>Path to the master trace file.</p>
</dd>
<dt>xmin<span class="classifier">int</span></dt><dd><p>Minimum x-coordinate for trace fitting.</p>
</dd>
<dt>fitspace<span class="classifier">int</span></dt><dd><p>Space for fitting.</p>
</dd>
<dt>min_pkheight<span class="classifier">int</span></dt><dd><p>Minimum peak height for peak detection.</p>
</dd>
<dt>window<span class="classifier">int</span></dt><dd><p>Window size for median calculation.</p>
</dd>
<dt>offset_cutoff<span class="classifier">int</span></dt><dd><p>Cutoff for offset calculation.</p>
</dd>
</dl>
<section id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>insert_dead_fibers(LUT, benchside, pkhts)</dt><dd><p>Inserts dead fibers into the peak heights array.</p>
</dd>
<dt>generate_valleys(tslice: float) -&gt; Tuple[np.ndarray, …]</dt><dd><p>Generates valleys in the given slice.</p>
</dd>
<dt>fit_bspline(valley_indices: np.ndarray, valley_depths: np.ndarray, invvar: np.ndarray) -&gt; Tuple[np.ndarray, …]</dt><dd><p>Fits a B-spline to the given valleys.</p>
</dd>
<dt>fit_grid_single(xtmp) -&gt; Tuple[float, bspline, int, np.ndarray]</dt><dd><p>Fits a grid to a single x-window.</p>
</dd>
<dt>find_comb(rownum=None)</dt><dd><p>Finds the comb for the given row number.</p>
</dd>
<dt>process_hdu_data(hdu_data: np.ndarray, hdu_header: dict, find_LUT=False) -&gt; dict</dt><dd><p>Processes data from a specific HDU array.</p>
</dd>
<dt>profileFit()</dt><dd><p>Fits the profile of the data.</p>
</dd>
<dt>saveTraces(outfile=’LLAMASTrace.pkl’)</dt><dd><p>Saves the traces to a file.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.__init__" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.insert_dead_fibers">
<span class="sig-name descname"><span class="pre">insert_dead_fibers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LUT</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">pkhts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.insert_dead_fibers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.insert_dead_fibers" title="Link to this definition"></a></dt>
<dd><p>Inserts zero values into the pkhts list at positions specified by dead fibers.
This method retrieves the list of dead fibers for a given benchside from the LUT (Lookup Table),
sorts the list, and then inserts a zero value into the pkhts list at each position corresponding
to a dead fiber.
:param LUT: A lookup table containing information about dead fibers.
:type LUT: dict
:param benchside: The benchside identifier to retrieve dead fibers for.
:type benchside: str
:param pkhts: A list of pkhts values where zeros will be inserted at positions of dead fibers.
:type pkhts: list</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The updated pkhts list with zeros inserted at positions of dead fibers.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.generate_valleys">
<span class="sig-name descname"><span class="pre">generate_valleys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tslice</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.generate_valleys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.generate_valleys" title="Link to this definition"></a></dt>
<dd><p>Detects valleys in the given data slice and returns their indices, depths, and an array of ones.
Parameters:
———–
tslice : float</p>
<blockquote>
<div><p>The data slice in which to detect valleys.</p>
</div></blockquote>
<section id="id3">
<h4>Returns:<a class="headerlink" href="#id3" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>Tuple[np.ndarray, …]</dt><dd><p>A tuple containing:
- valley_indices (np.ndarray): The indices of the detected valleys.
- valley_depths (np.ndarray): The depths of the detected valleys.
- invvar (np.ndarray): An array of ones with the same length as the number of detected valleys.</p>
</dd>
</dl>
</section>
<section id="id4">
<h4>Notes:<a class="headerlink" href="#id4" title="Link to this heading"></a></h4>
<p>If no valleys are detected, a log message is generated indicating that no valleys were found and suggesting to check the threshold.</p>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.fit_bspline">
<span class="sig-name descname"><span class="pre">fit_bspline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">valley_indices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">valley_depths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">invvar</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.fit_bspline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.fit_bspline" title="Link to this definition"></a></dt>
<dd><p>Fit a B-spline to the given valley indices and depths.
Parameters:
valley_indices (np.ndarray): Array of indices where valleys are located.
valley_depths (np.ndarray): Array of depths corresponding to the valley indices.
invvar (np.ndarray): Inverse variance of the valley depths.
Returns:
Tuple[np.ndarray, …]: A tuple containing the x_model and the fitted y_model values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.fit_grid_single">
<span class="sig-name descname"><span class="pre">fit_grid_single</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xtmp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bspline</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.fit_grid_single"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.fit_grid_single" title="Link to this definition"></a></dt>
<dd><p>Fits a B-spline to a slice of the data at a given x-window point.
Parameters:
———–
xtmp : int</p>
<blockquote>
<div><p>The x-coordinate around which the y-slice is taken.</p>
</div></blockquote>
<section id="id5">
<h4>Returns:<a class="headerlink" href="#id5" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>comb<span class="classifier">np.ndarray</span></dt><dd><p>The combined result of the y-slice minus the B-spline model.</p>
</dd>
<dt>sset<span class="classifier">bspline</span></dt><dd><p>The B-spline object fitted to the data.</p>
</dd>
<dt>res<span class="classifier">int</span></dt><dd><p>The result of the B-spline fitting process.</p>
</dd>
<dt>yfit<span class="classifier">np.ndarray</span></dt><dd><p>The fitted y-values from the B-spline model.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.find_comb">
<span class="sig-name descname"><span class="pre">find_comb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rownum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.find_comb"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.find_comb" title="Link to this definition"></a></dt>
<dd><p>Find and process the comb of peaks in the data.
This function extracts a slice of the data around the specified row number,
identifies valleys, fits a B-spline to the valleys, and then finds peaks
in the residuals after subtracting the fitted B-spline.
Parameters:
rownum (int, optional): The row number around which to extract the data slice.</p>
<blockquote>
<div><p>If None, the middle row is used.</p>
</div></blockquote>
<p>Returns:
numpy.ndarray: The comb of peaks in the data slice after subtracting the fitted B-spline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.process_hdu_data">
<span class="sig-name descname"><span class="pre">process_hdu_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdu_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdu_header</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">find_LUT</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.process_hdu_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.process_hdu_data" title="Link to this definition"></a></dt>
<dd><p>Processes data from a specific HDU (Header Data Unit) array.
Parameters:
———–
hdu_data : np.ndarray</p>
<blockquote>
<div><p>The data array from the HDU to be processed.</p>
</div></blockquote>
<dl class="simple">
<dt>hdu_header<span class="classifier">dict</span></dt><dd><p>The header information associated with the HDU data.</p>
</dd>
<dt>find_LUT<span class="classifier">bool, optional</span></dt><dd><p>Flag to determine whether to find and use a Look-Up Table (LUT) for processing (default is False).</p>
</dd>
</dl>
<section id="id6">
<h4>Returns:<a class="headerlink" href="#id6" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>dict</dt><dd><p>A dictionary containing the status of the processing. If successful, returns {“status”: “success”}.
If an error occurs, returns {“status”: “failed”, “error”: str(e), ‘channel’: self.channel, ‘bench’: self.bench, ‘side’: self.side}.</p>
</dd>
</dl>
</section>
<section id="id7">
<h4>Description:<a class="headerlink" href="#id7" title="Link to this heading"></a></h4>
<p>This method processes the HDU data by performing the following steps:
1. Initializes the bspline_ssets list.
2. Extracts and processes header information to determine the channel, bench, and side.
3. Extracts the dimensions of the data (NAXIS1 and NAXIS2).
4. Finds the initial comb for the data to be fitted.
5. Updates peaks and peak heights, ensuring they are not too close to the edge.
6. Optionally, opens and uses a trace Look-Up Table (LUT) to account for dead fibers.
7. Determines the number of fibers and the maximum x-axis value for tracing.
8. Fits combs from the midpoint forward and then backward, updating peak positions.
9. Defines the coordinates of the trace along the x-axis and fits a spline along the x-axis for each fiber.
10. Interpolates the traces to give x, y positions for each fiber along the naxis.
Exceptions:
———–
If an error occurs during processing, the method catches the exception, logs the error, and returns a dictionary with the status “failed” and the error message.</p>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.profileFit">
<span class="sig-name descname"><span class="pre">profileFit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.profileFit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.profileFit" title="Link to this definition"></a></dt>
<dd><p>Fits the spatial profile of fibers in the data.
This method normalizes the data, generates masks for bad pixels, and fits
the spatial profile of fibers using a bspline. The results are stored in
the instance variables <cite>fiberimg</cite>, <cite>profimg</cite>, and <cite>bpmask</cite>.
:returns:</p>
<blockquote>
<div><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>fiberimg (ndarray): An array listing the fiber number of each pixel.</p></li>
<li><p>profimg (ndarray): An array containing the profile weighting function.</p></li>
<li><p>bpmask (ndarray): A boolean array representing the bad pixel mask.</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.saveTraces">
<span class="sig-name descname"><span class="pre">saveTraces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LLAMASTrace.pkl'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#TraceLlamas.saveTraces"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.TraceLlamas.saveTraces" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMaster_backup.run_ray_tracing">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMaster_backup.</span></span><span class="sig-name descname"><span class="pre">run_ray_tracing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMaster_backup.html#run_ray_tracing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMaster_backup.run_ray_tracing" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="module-llamas_pyjamas.Trace.traceLlamasMulti">
<span id="llamas-pyjamas-trace-tracellamasmulti-module"></span><h2>llamas_pyjamas.Trace.traceLlamasMulti module<a class="headerlink" href="#module-llamas_pyjamas.Trace.traceLlamasMulti" title="Link to this heading"></a></h2>
<p>Module: traceLlamasMulti
This module provides functionality for processing and tracing fibers in LLAMAS FITS files using Ray multiprocessing.
It includes classes and methods for detecting peaks, fitting B-splines, and generating fiber profiles.
The main class, TraceLlamas, handles the core processing logic, including:
- Loading and processing FITS files
- Detecting peaks and valleys in the data
- Fitting B-splines to the detected features
- Generating fiber profiles and bad pixel masks
- Saving the processed traces to output files
The module relies on a set of master traces already being produced to apply cross-correlation methods of matching the combs.
This ensures accurate alignment and tracing of fibers across different channels and bench sides.
Classes:
- TraceLlamas: Core class for processing and tracing fibers in LLAMAS FITS files.
- TraceRay: Subclass of TraceLlamas that integrates Ray for parallel processing.
Functions:
- run_ray_tracing: Function to initiate Ray-based tracing on a given FITS file.
Usage:
- The module can be run as a standalone script with command-line arguments to specify the input FITS file and other options.</p>
<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.get_fiber_position">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMulti.</span></span><span class="sig-name descname"><span class="pre">get_fiber_position</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">fiber</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#get_fiber_position"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.get_fiber_position" title="Link to this definition"></a></dt>
<dd><p>Retrieve the position of a fiber from a lookup table (LUT) based on the given channel, benchside, and fiber identifier.
:param channel: The channel name to look up in the LUT (red, blue or green).
:type channel: str
:param benchside: The benchside identifier to look up in the LUT (e.g., ‘1A’).
:type benchside: str
:param fiber: The fiber identifier to look up in the LUT.
:type fiber: str</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The position of the specified fiber.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)">int</a></p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#FileNotFoundError" title="(in Python v3.13)"><strong>FileNotFoundError</strong></a> – If the LUT file does not exist.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.13)"><strong>KeyError</strong></a> – If the specified channel, benchside, or fiber is not found in the LUT.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.cross_correlate_combs">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMulti.</span></span><span class="sig-name descname"><span class="pre">cross_correlate_combs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">comb1</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">comb2</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#cross_correlate_combs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.cross_correlate_combs" title="Link to this definition"></a></dt>
<dd><p>Cross correlate two combs to find the offset between them.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMulti.</span></span><span class="sig-name descname"><span class="pre">TraceLlamas</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A class to trace and process fiber positions in a FITS file.
Attributes:
———–
fitsfile : str</p>
<blockquote>
<div><p>The path to the FITS file to be processed.</p>
</div></blockquote>
<dl class="simple">
<dt>mph<span class="classifier">Optional[int]</span></dt><dd><p>Minimum peak height for peak detection.</p>
</dd>
<dt>master_trace<span class="classifier">Optional[str]</span></dt><dd><p>Path to the master trace file.</p>
</dd>
<dt>xmin<span class="classifier">int</span></dt><dd><p>Minimum x-coordinate for trace fitting.</p>
</dd>
<dt>fitspace<span class="classifier">int</span></dt><dd><p>Space for fitting.</p>
</dd>
<dt>min_pkheight<span class="classifier">int</span></dt><dd><p>Minimum peak height for peak detection.</p>
</dd>
<dt>window<span class="classifier">int</span></dt><dd><p>Window size for median calculation.</p>
</dd>
<dt>offset_cutoff<span class="classifier">int</span></dt><dd><p>Cutoff for offset in cross-correlation.</p>
</dd>
</dl>
<section id="id8">
<h3>Methods:<a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<dl class="simple">
<dt>insert_dead_fibers(LUT, benchside, pkhts):</dt><dd><p>Inserts dead fibers into the peak heights array.</p>
</dd>
<dt>generate_valleys(tslice: float) -&gt; Tuple[np.ndarray, …]:</dt><dd><p>Generates valleys in the given slice.</p>
</dd>
<dt>fit_bspline(valley_indices: np.ndarray, valley_depths: np.ndarray, invvar: np.ndarray) -&gt; Tuple[np.ndarray, …]:</dt><dd><p>Fits a B-spline to the given valleys.</p>
</dd>
<dt>fit_grid_single(xtmp) -&gt; Tuple[float, bspline, int, np.ndarray]:</dt><dd><p>Fits a grid to a single x-window.</p>
</dd>
<dt>find_comb(rownum=None):</dt><dd><p>Finds the comb for the given row number.</p>
</dd>
<dt>process_hdu_data(hdu_data: np.ndarray, hdu_header: dict, find_LUT=False) -&gt; dict:</dt><dd><p>Processes data from a specific HDU array.</p>
</dd>
<dt>profileFit():</dt><dd><p>Fits the profile of the fibers.</p>
</dd>
<dt>saveTraces(outfile=’LLAMASTrace.pkl’):</dt><dd><p>Saves the traces to a file.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">mph</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">master_trace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.__init__" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.insert_dead_fibers">
<span class="sig-name descname"><span class="pre">insert_dead_fibers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">LUT</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchside</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">pkhts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.insert_dead_fibers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.insert_dead_fibers" title="Link to this definition"></a></dt>
<dd><p>Inserts dead fibers into the peak heights array at the positions specified in the LUT.
Parameters:
- LUT (dict): Lookup table containing information about dead fibers.
- benchside (str): The benchside identifier to look up dead fibers in the LUT.
- pkhts (np.ndarray): Array of peak heights to insert dead fibers into.
Returns:
- np.ndarray: The updated array with dead fibers inserted at the specified positions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.generate_valleys">
<span class="sig-name descname"><span class="pre">generate_valleys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tslice</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.generate_valleys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.generate_valleys" title="Link to this definition"></a></dt>
<dd><p>Generate valleys from a given slice of the raw image.
This method detects valleys in the provided slice data and returns
the indices and depths of the valleys, along with an array of inverse variances.
Parameters:
tslice (float): The slice data from which valleys are to be detected.
Returns:
Tuple[np.ndarray, …]: A tuple containing:</p>
<blockquote>
<div><ul class="simple">
<li><p>valley_indices (np.ndarray): The indices of the detected valleys.</p></li>
<li><p>valley_depths (np.ndarray): The depths of the detected valleys.</p></li>
<li><p>invvar (np.ndarray): An array of ones with the same length as the number of detected valleys.</p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.fit_bspline">
<span class="sig-name descname"><span class="pre">fit_bspline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">valley_indices</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">valley_depths</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">invvar</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.fit_bspline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.fit_bspline" title="Link to this definition"></a></dt>
<dd><p>Fit a B-spline to the given valley indices and depths.
Parameters:
valley_indices (np.ndarray): Array of indices where valleys are located.
valley_depths (np.ndarray): Array of depths corresponding to the valley indices.
invvar (np.ndarray): Array of inverse variances for the valley depths.
Returns:
Tuple[np.ndarray, …]: A tuple containing the x_model and the fitted y_model values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.fit_grid_single">
<span class="sig-name descname"><span class="pre">fit_grid_single</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xtmp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bspline</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.fit_grid_single"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.fit_grid_single" title="Link to this definition"></a></dt>
<dd><p>Fits a grid to a single x-window point and returns the residuals, bspline object,
fit result, and fitted y-values.
Parameters:
———–
xtmp : int</p>
<blockquote>
<div><p>The x-window point around which the fitting is performed.</p>
</div></blockquote>
<section id="id9">
<h4>Returns:<a class="headerlink" href="#id9" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>comb<span class="classifier">np.ndarray</span></dt><dd><p>The residuals after subtracting the model from the y-trace.</p>
</dd>
<dt>sset<span class="classifier">bspline</span></dt><dd><p>The bspline object used for fitting.</p>
</dd>
<dt>res<span class="classifier">int</span></dt><dd><p>The result of the bspline fit.</p>
</dd>
<dt>yfit<span class="classifier">np.ndarray</span></dt><dd><p>The fitted y-values from the bspline model.</p>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.find_comb">
<span class="sig-name descname"><span class="pre">find_comb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rownum</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.find_comb"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.find_comb" title="Link to this definition"></a></dt>
<dd><p>Find and process the comb of peaks in the data.
This function extracts a slice of the data around the specified row number,
identifies valleys, fits a B-spline to the valleys, and then finds peaks
in the residuals after subtracting the fitted B-spline.
Parameters:
rownum (int, optional): The row number around which to extract the data slice.</p>
<blockquote>
<div><p>If None, the middle row is used.</p>
</div></blockquote>
<p>Returns:
numpy.ndarray: The comb of peaks in the data slice after subtracting the fitted B-spline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.process_hdu_data">
<span class="sig-name descname"><span class="pre">process_hdu_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hdu_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdu_header</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.process_hdu_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.process_hdu_data" title="Link to this definition"></a></dt>
<dd><p>Processes data from a specific HDU (Header Data Unit) array.
Parameters:
———–
hdu_data : np.ndarray</p>
<blockquote>
<div><p>The data array from the HDU to be processed.</p>
</div></blockquote>
<dl class="simple">
<dt>hdu_header<span class="classifier">dict</span></dt><dd><p>The header information associated with the HDU data.</p>
</dd>
<dt>find_LUT<span class="classifier">bool, optional</span></dt><dd><p>If True, the function will only find the LUT (Lookup Table) and return without further processing. Default is False.</p>
</dd>
</dl>
<section id="id10">
<h4>Returns:<a class="headerlink" href="#id10" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>dict</dt><dd><p>A dictionary containing the status of the processing. If successful, returns {“status”: “success”}.
If an error occurs, returns {“status”: “failed”, “error”: str(e), ‘channel’: self.channel, ‘bench’: self.bench, ‘side’: self.side}.</p>
</dd>
</dl>
</section>
<section id="raises">
<h4>Raises:<a class="headerlink" href="#raises" title="Link to this heading"></a></h4>
<dl class="simple">
<dt>Exception</dt><dd><p>If any error occurs during the processing, it will be caught and logged, and the function will return a failure status.</p>
</dd>
</dl>
</section>
<section id="id11">
<h4>Notes:<a class="headerlink" href="#id11" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>The function processes the HDU data by extracting relevant information from the header and data array.</p></li>
<li><p>It handles different cases based on the presence of specific header keys (‘COLOR’, ‘CAM_NAME’).</p></li>
<li><p>The function reads a trace LUT (Lookup Table) from a JSON file and updates peaks and peak heights arrays.</p></li>
<li><p>It performs cross-correlation to find offsets and updates the comb and peaks accordingly.</p></li>
<li><p>The function fits traces from the midpoint forward and backward, updating the trace array.</p></li>
<li><p>It defines the coordinates of the trace along the x-axis and fits a spline along the x-axis for each fiber.</p></li>
<li><p>The function interpolates the traces to give x, y positions for each fiber along the naxis.</p></li>
</ul>
</section>
<section id="example">
<h4>Example:<a class="headerlink" href="#example" title="Link to this heading"></a></h4>
<p>result = process_hdu_data(hdu_data, hdu_header, find_LUT=True)</p>
</section>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.profileFit">
<span class="sig-name descname"><span class="pre">profileFit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.profileFit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.profileFit" title="Link to this definition"></a></dt>
<dd><p>Fits the spatial profile of fibers in the data.
This method normalizes the data, generates masks for bad pixels, and fits
the fiber spatial profile using a bspline. It updates the fiber image,
profile image, and bad pixel mask attributes of the class.
:returns:</p>
<blockquote>
<div><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>fiberimg (numpy.ndarray): An array listing the fiber number of each pixel.</p></li>
<li><p>profimg (numpy.ndarray): An array representing the profile weighting function.</p></li>
<li><p>bpmask (numpy.ndarray): A boolean array representing the bad pixel mask.</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.saveTraces">
<span class="sig-name descname"><span class="pre">saveTraces</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outfile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LLAMASTrace.pkl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">newpath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_ray_trace_ctx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#TraceLlamas.saveTraces"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.TraceLlamas.saveTraces" title="Link to this definition"></a></dt>
<dd><p>Save trace data to a specified file format.
Parameters:
outfile (str): The name of the output file. Default is ‘LLAMASTrace.pkl’.</p>
<blockquote>
<div><p>Supported formats are ‘.pkl’ for pickle files and ‘.h5’ for HDF5 files.</p>
</div></blockquote>
<p>This method saves the trace data of the object to a file in the specified format.
If the output file is a pickle file (‘.pkl’), the entire object is serialized using cloudpickle.
If the output file is an HDF5 file (‘.h5’), the trace data and other attributes are saved in datasets.
The output file is saved in a directory named after the base name of the FITS file with ‘_traces’ appended.
Raises:
OSError: If there is an error creating the output directory or writing the file.
Example:
&gt;&gt;&gt; obj.saveTraces(‘output_traces.h5’)</p>
</dd></dl>

</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="llamas_pyjamas.Trace.traceLlamasMulti.run_ray_tracing">
<span class="sig-prename descclassname"><span class="pre">llamas_pyjamas.Trace.traceLlamasMulti.</span></span><span class="sig-name descname"><span class="pre">run_ray_tracing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fitsfile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span></span><a class="reference internal" href="_modules/llamas_pyjamas/Trace/traceLlamasMulti.html#run_ray_tracing"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#llamas_pyjamas.Trace.traceLlamasMulti.run_ray_tracing" title="Link to this definition"></a></dt>
<dd><p>Perform ray tracing on a FITS file using parallel processing with Ray.
This function initializes Ray with the number of available CPU cores, processes
each HDU (Header Data Unit) in the FITS file using a remote TraceRay actor, and
monitors the processing status, including CPU usage.
Parameters:
fitsfile (str): The path to the FITS file to be processed.
Returns:
None</p>
</dd></dl>

</section>
<section id="module-llamas_pyjamas.Trace">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-llamas_pyjamas.Trace" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, LLAMAS Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>